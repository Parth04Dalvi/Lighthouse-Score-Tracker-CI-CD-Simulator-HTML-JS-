<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lighthouse CI/CD Performance Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            /* Add background image to body for full page coverage */
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="%23cbd5e1" stroke-width="0.5" stroke-linecap="round" stroke-linejoin="round" class="feather feather-lighthouse"><path d="M20 18V5a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v13M20 18a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2M20 18h-2M4 18H6M12 4v4M12 11v4M12 18v4M7 10h10M7 14h10M3 17h18M12 1l2 2-2 2-2-2 2-2z"/></svg>');
            background-repeat: no-repeat;
            background-position: top 50px right 50px; /* Adjust position as needed */
            background-size: 150px; /* Adjust size as needed */
            background-attachment: fixed; /* Keep it fixed when scrolling */
            opacity: 0.1; /* Adjust transparency as needed */
        }
        .card {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06);
            border-radius: 0.5rem;
        }
        /* Custom spinner for loading state */
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid #3b82f6; /* Blue */
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

    <div id="app" class="min-h-screen p-4 md:p-10">
        <!-- Header --><header class="mb-8 border-b pb-4">
            <h1 class="text-3xl font-extrabold text-gray-900 flex items-center">
                <svg class="w-7 h-7 mr-2 text-indigo-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                Performance CI/CD Simulator
            </h1>
            <p class="text-gray-600 mt-1">Simulated performance gating and historical tracking for recruiters.</p>
        </header>

        <!-- Input and Control Panel --><div class="card bg-white p-5 mb-8 grid grid-cols-2 md:grid-cols-6 gap-4 items-end">
            <div class="col-span-2 md:col-span-3">
                <label for="target-url" class="block text-sm font-medium text-gray-700">Target URL (Simulated)</label>
                <input type="url" id="target-url" value="https://google.com" placeholder="Enter URL to audit" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500">
            </div>
            
            <div class="col-span-1 md:col-span-1">
                <label for="min-score" class="block text-sm font-medium text-gray-700">CI/CD Min Score</label>
                <input type="number" id="min-score" value="85" min="0" max="100" class="mt-1 block w-full p-2 border border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500 text-center">
            </div>

            <div class="col-span-2 md:col-span-2 space-y-2">
                <button onclick="runAudit()" id="run-button" class="w-full py-2.5 px-4 bg-indigo-600 text-white font-bold rounded-lg hover:bg-indigo-700 transition duration-200 shadow-md flex items-center justify-center">
                    <span id="button-text">Run Simulated Audit</span>
                    <div id="loading-spinner" class="spinner hidden ml-3"></div>
                </button>
                <button onclick="clearHistory()" class="w-full py-1.5 px-4 bg-gray-200 text-gray-700 text-sm rounded-lg hover:bg-gray-300 transition duration-200">
                    Clear Historical Data
                </button>
            </div>
        </div>

        <!-- Results Dashboard --><div id="dashboard-results" class="space-y-6 hidden">
            
            <!-- Overall Score, Gate Status & Core Vitals --><div class="grid grid-cols-1 lg:grid-cols-5 gap-6">
                
                <!-- Overall Lighthouse Score Gauge --><div class="card bg-white p-6 lg:col-span-2 flex flex-col items-center justify-center border-t-4 border-indigo-500">
                    <h2 class="text-xl font-bold text-gray-800 mb-4">Overall Performance Score</h2>
                    <div class="w-48 h-48 relative">
                        <canvas id="scoreGauge"></canvas>
                        <div class="absolute inset-0 flex flex-col items-center justify-center">
                            <span id="overall-score" class="text-5xl font-extrabold text-gray-900">--</span>
                            <span class="text-sm text-gray-500 mt-1">Lighthouse</span>
                        </div>
                    </div>
                    <p id="audit-url-display" class="text-sm text-gray-500 mt-4 truncate max-w-full">Auditing: https://google.com</p>
                </div>

                <!-- CI/CD Gate Status & Metrics --><div class="card bg-white p-6 lg:col-span-3 grid grid-cols-2 gap-4">
                    <div class="col-span-2 border-b pb-2 flex justify-between items-center">
                        <h2 class="text-xl font-bold text-gray-800">CI/CD Pipeline Status</h2>
                        <div id="gate-status-badge" class="px-3 py-1 text-sm font-bold rounded-full bg-gray-200 text-gray-700">Awaiting Run</div>
                    </div>

                    <!-- Metric 1: First Contentful Paint (FCP) --><div id="kpi-fcp-card" class="p-3 rounded-lg border-2 flex flex-col justify-center transition duration-300">
                        <p class="text-sm font-medium text-gray-500">FCP (First Contentful Paint)</p>
                        <p id="kpi-fcp" class="text-xl font-bold mt-1 text-gray-900">-- ms</p>
                        <span id="fcp-status" class="text-xs font-semibold mt-1">Status: Unknown</span>
                    </div>

                    <!-- Metric 2: Largest Contentful Paint (LCP) --><div id="kpi-lcp-card" class="p-3 rounded-lg border-2 flex flex-col justify-center transition duration-300">
                        <p class="text-sm font-medium text-gray-500">LCP (Largest Contentful Paint)</p>
                        <p id="kpi-lcp" class="text-xl font-bold mt-1 text-gray-900">-- ms</p>
                        <span id="lcp-status" class="text-xs font-semibold mt-1">Status: Unknown</span>
                    </div>

                    <!-- Metric 3: Total Blocking Time (TBT) --><div id="kpi-tbt-card" class="p-3 rounded-lg border-2 flex flex-col justify-center transition duration-300">
                        <p class="text-sm font-medium text-gray-500">TBT (Total Blocking Time)</p>
                        <p id="kpi-tbt" class="text-xl font-bold mt-1 text-gray-900">-- ms</p>
                        <span id="tbt-status" class="text-xs font-semibold mt-1">Status: Unknown</span>
                    </div>
                    
                    <!-- Metric 4: Cumulative Layout Shift (CLS) --><div id="kpi-cls-card" class="p-3 rounded-lg border-2 flex flex-col justify-center transition duration-300">
                        <p class="text-sm font-medium text-gray-500">CLS (Layout Shift Score)</p>
                        <p id="kpi-cls" class="text-xl font-bold mt-1 text-gray-900">--</p>
                        <span id="cls-status" class="text-xs font-semibold mt-1">Status: Unknown</span>
                    </div>
                </div>
            </div>
            
            <!-- Historical Trend Chart (Multi-Metric) --><div class="card bg-white p-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">Historical Performance Trend (Score & LCP)</h2>
                <div class="h-80">
                    <canvas id="historicalChart"></canvas>
                </div>
            </div>

            <!-- Opportunities & Diagnostics --><div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                 <!-- Top Opportunities for Improvement --><div class="card bg-white p-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center"><svg class="w-5 h-5 mr-2 text-red-500" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg>Top Opportunities (Failing Audits)</h2>
                    <ul id="opportunities-list" class="space-y-3">
                        <li class="text-gray-500">Run an audit to see opportunities.</li>
                    </ul>
                </div>
                <!-- Passed Audits & Diagnostics --><div class="card bg-white p-6">
                    <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center"><svg class="w-5 h-5 mr-2 text-green-500" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>Passed Audits & Diagnostics</h2>
                    <ul id="diagnostics-list" class="space-y-3">
                        <li class="text-gray-500">Run an audit to see passed checks.</li>
                    </ul>
                </div>
            </div>
            
        </div>

        <!-- Initial Placeholder Message --><div id="initial-message" class="text-center p-12 bg-white rounded-xl shadow-lg max-w-lg mx-auto">
            <svg class="w-16 h-16 mx-auto text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            <h3 class="mt-4 text-lg font-medium text-gray-900">Start a Performance Audit</h3>
            <p class="mt-1 text-sm text-gray-500">Enter a URL and a minimum CI/CD score above to run a simulated Lighthouse report.</p>
        </div>
        
    </div>

    <script>
        // --- Core Simulation Logic ---

        /**
         * Simulates a structured Lighthouse report response with realistic metric tiers.
         * @param {number} minScore - The CI/CD minimum required score.
         * @returns {object} The mock report object.
         */
        function generateMockReport(minScore) {
            // Generate a realistic, slightly random score (40-100)
            const score = Math.floor(Math.random() * 60) + 40;

            // Define metric bands
            const good = score >= 90;
            const average = score >= 50 && score < 90;
            
            const randomTime = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;

            const metricTime = (goodMin, goodMax, avgMin, avgMax, badMin, badMax) => {
                if (good) return randomTime(goodMin, goodMax);
                if (average) return randomTime(avgMin, avgMax);
                return randomTime(badMin, badMax); // Poor score
            };

            const opportunities = [];
            const diagnostics = [
                { title: "Avoid large network payloads", estimatedSavings: "0ms" },
                { title: "Serve static assets with an efficient cache policy", estimatedSavings: "0ms" },
            ];

            // Dynamically generate opportunities based on the score tier
            if (score < 90) {
                 opportunities.push({ title: "Reduce JavaScript execution time", estimatedSavings: `${randomTime(200, 800)}ms` });
            }
            if (score < 70) {
                 opportunities.push({ title: "Ensure text remains visible during webfont load", estimatedSavings: "100ms" });
                 opportunities.push({ title: "Avoid chaining critical requests", estimatedSavings: `${randomTime(100, 300)}ms` });
            }
            if (score < 50) {
                opportunities.push({ title: "Serve images in next-gen formats", estimatedSavings: `${randomTime(300, 1500)}ms` });
                opportunities.push({ title: "Minimize main-thread work (High TBT)", estimatedSavings: `${randomTime(500, 1000)}ms` });
            }

            // Ensure at least 3 opportunities are listed, unless the score is very high
            while (opportunities.length < 3 && score < 95) {
                const defaultOps = ["Reduce JavaScript payload", "Optimize images", "Eliminate render-blocking resources"];
                const newOp = defaultOps[Math.floor(Math.random() * defaultOps.length)];
                if (!opportunities.find(op => op.title.includes(newOp.split(' ')[0]))) {
                    opportunities.push({ title: newOp, estimatedSavings: `${randomTime(50, 300)}ms` });
                }
            }


            return {
                overallScore: score,
                gateStatus: score >= minScore ? 'PASS' : 'FAIL',
                metrics: {
                    fcp: metricTime(500, 1500, 1800, 3000, 3500, 6000), // FCP: Good < 1800ms
                    lcp: metricTime(1000, 2500, 2500, 4000, 4500, 8000), // LCP: Good < 2500ms
                    tbt: metricTime(0, 50, 200, 600, 700, 1500),         // TBT: Good < 200ms
                    cls: good ? (Math.random() * 0.05).toFixed(3) : average ? (Math.random() * 0.2).toFixed(3) : (Math.random() * 0.4).toFixed(3), // CLS: Good < 0.1
                },
                opportunities: opportunities,
                diagnostics: diagnostics
            };
        }

        // --- State and UI Management ---

        let historicalData = JSON.parse(localStorage.getItem('historicalScores')) || [];
        let historicalChartInstance = null;
        let scoreGaugeInstance = null;
        
        /**
         * Sets the loading state on the main run button.
         * @param {boolean} isLoading - Whether the audit is currently running.
         */
        function setLoadingState(isLoading) {
            const button = document.getElementById('run-button');
            const buttonText = document.getElementById('button-text');
            const spinner = document.getElementById('loading-spinner');

            if (isLoading) {
                button.disabled = true;
                buttonText.textContent = 'Processing...';
                spinner.classList.remove('hidden');
            } else {
                button.disabled = false;
                buttonText.textContent = 'Run Simulated Audit';
                spinner.classList.add('hidden');
            }
        }

        /**
         * Determines status and required Tailwind classes for a metric.
         * @param {string} metric - The metric code (fcp, lcp, tbt, cls).
         * @param {number} value - The metric value.
         * @returns {object} Status and corresponding Tailwind classes.
         */
        function getMetricStatus(metric, value) {
            let status, textClass, borderClass, bgClass;

            if (metric === 'fcp') {
                if (value <= 1800) { status = 'Good (<1.8s)'; textClass = 'text-green-800'; borderClass = 'border-green-500'; bgClass = 'bg-green-50'; }
                else if (value <= 3000) { status = 'NI (1.8s - 3s)'; textClass = 'text-yellow-800'; borderClass = 'border-yellow-500'; bgClass = 'bg-yellow-50'; }
                else { status = 'Poor (>3s)'; textClass = 'text-red-800'; borderClass = 'border-red-500'; bgClass = 'bg-red-50'; }
            } else if (metric === 'lcp') {
                if (value <= 2500) { status = 'Good (<2.5s)'; textClass = 'text-green-800'; borderClass = 'border-green-500'; bgClass = 'bg-green-50'; }
                else if (value <= 4000) { status = 'NI (2.5s - 4s)'; textClass = 'text-yellow-800'; borderClass = 'border-yellow-500'; bgClass = 'bg-yellow-50'; }
                else { status = 'Poor (>4s)'; textClass = 'text-red-800'; borderClass = 'border-red-500'; bgClass = 'bg-red-50'; }
            } else if (metric === 'tbt') {
                if (value <= 200) { status = 'Good (<200ms)'; textClass = 'text-green-800'; borderClass = 'border-green-500'; bgClass = 'bg-green-50'; }
                else if (value <= 600) { status = 'NI (200 - 600ms)'; textClass = 'text-yellow-800'; borderClass = 'border-yellow-500'; bgClass = 'bg-yellow-50'; }
                else { status = 'Poor (>600ms)'; textClass = 'text-red-800'; borderClass = 'border-red-500'; bgClass = 'bg-red-50'; }
            } else if (metric === 'cls') {
                const clsVal = parseFloat(value);
                if (clsVal <= 0.1) { status = 'Good (<0.1)'; textClass = 'text-green-800'; borderClass = 'border-green-500'; bgClass = 'bg-green-50'; }
                else if (clsVal <= 0.25) { status = 'NI (0.1 - 0.25)'; textClass = 'text-yellow-800'; borderClass = 'border-yellow-500'; bgClass = 'bg-yellow-50'; }
                else { status = 'Poor (>0.25)'; textClass = 'text-red-800'; borderClass = 'border-red-500'; bgClass = 'bg-red-50'; }
            }

            return { status, textClass, borderClass, bgClass };
        }

        /**
         * Main function to run the simulated audit, handle UI updates, and persist data.
         */
        async function runAudit() {
            const urlInput = document.getElementById('target-url');
            const minScoreInput = document.getElementById('min-score');
            const url = urlInput.value.trim();
            const minScore = parseInt(minScoreInput.value);

            if (!url || isNaN(minScore) || minScore < 0 || minScore > 100) {
                alert("Please enter a valid URL and a minimum score between 0 and 100.");
                return;
            }

            // Hide initial message and show dashboard
            document.getElementById('initial-message').classList.add('hidden');
            document.getElementById('dashboard-results').classList.remove('hidden');

            setLoadingState(true);
            document.getElementById('audit-url-display').textContent = `Auditing: ${url}`;
            
            // Set gate status to pending
            const gateBadge = document.getElementById('gate-status-badge');
            gateBadge.textContent = 'Running Audit...';
            gateBadge.className = 'px-3 py-1 text-sm font-bold rounded-full bg-blue-200 text-blue-700';


            try {
                // 1. Simulate API call
                await new Promise(resolve => setTimeout(resolve, 3000)); // 3 second delay
                
                // 2. Generate and store report
                const report = generateMockReport(minScore);
                const timestamp = new Date().toLocaleTimeString();

                // 3. Update historical data (limit to last 10 audits)
                historicalData.push({ 
                    score: report.overallScore, 
                    lcp: report.metrics.lcp, // Track LCP for multi-metric chart
                    label: timestamp 
                });
                if (historicalData.length > 10) {
                    historicalData.shift();
                }
                localStorage.setItem('historicalScores', JSON.stringify(historicalData));

                // 4. Render results
                renderResults(report);

            } catch (error) {
                console.error("Audit Simulation Failed:", error);
                // Use a custom modal or inline message instead of alert
                document.getElementById('gate-status-badge').textContent = 'SIMULATION ERROR';
                document.getElementById('gate-status-badge').className = 'px-3 py-1 text-sm font-bold rounded-full bg-gray-500 text-white';
            } finally {
                setLoadingState(false);
            }
        }

        /**
         * Clears all historical data from localStorage and resets the UI.
         */
        function clearHistory() {
            localStorage.removeItem('historicalScores');
            historicalData = [];
            
            if (historicalChartInstance) historicalChartInstance.destroy();
            
            // Show initial message again
            document.getElementById('initial-message').classList.remove('hidden');
            document.getElementById('dashboard-results').classList.add('hidden');
            alert("Historical data cleared!"); // Using alert just for confirmation in this sandbox environment
        }

        /**
         * Renders all report data onto the dashboard.
         * @param {object} report - The generated mock report data.
         */
        function renderResults(report) {
            // 1. Render Overall Score Gauge
            renderScoreGauge(report.overallScore);
            document.getElementById('overall-score').textContent = report.overallScore;
            
            // 2. Render CI/CD Gate Status
            const gateBadge = document.getElementById('gate-status-badge');
            if (report.gateStatus === 'PASS') {
                gateBadge.textContent = 'CI GATE PASS: DEPLOYMENT OK';
                gateBadge.className = 'px-3 py-1 text-sm font-bold rounded-full bg-green-500 text-white';
            } else {
                gateBadge.textContent = `CI GATE FAIL: Score ${report.overallScore} < Min ${document.getElementById('min-score').value}`;
                gateBadge.className = 'px-3 py-1 text-sm font-bold rounded-full bg-red-600 text-white';
            }

            // 3. Render Core Vitals KPIs (Dynamic colors)
            
            const kpis = [
                { id: 'fcp', value: report.metrics.fcp, unit: ' ms', cardId: 'kpi-fcp-card', isCls: false },
                { id: 'lcp', value: report.metrics.lcp, unit: ' ms', cardId: 'kpi-lcp-card', isCls: false },
                { id: 'tbt', value: report.metrics.tbt, unit: ' ms', cardId: 'kpi-tbt-card', isCls: false },
                { id: 'cls', value: report.metrics.cls, unit: '', cardId: 'kpi-cls-card', isCls: true },
            ];

            kpis.forEach(kpi => {
                const status = getMetricStatus(kpi.id, kpi.isCls ? parseFloat(kpi.value) : kpi.value);
                
                document.getElementById(`kpi-${kpi.id}`).textContent = `${kpi.value}${kpi.unit}`;
                
                const statusElement = document.getElementById(`${kpi.id}-status`);
                statusElement.textContent = `Status: ${status.status}`;
                statusElement.className = `text-xs font-semibold mt-1 ${status.textClass}`;
                
                const cardElement = document.getElementById(kpi.cardId);
                // Apply the border and background color based on status
                cardElement.className = `p-3 rounded-lg border-2 flex flex-col justify-center transition duration-300 ${status.borderClass} ${status.bgClass}`;
            });

            // 4. Render Historical Trend (Multi-Metric)
            renderHistoricalChart();
            
            // 5. Render Opportunities List
            const opportunitiesList = document.getElementById('opportunities-list');
            opportunitiesList.innerHTML = '';
            if (report.opportunities.length === 0) {
                 opportunitiesList.innerHTML = '<li class="p-3 bg-green-50 rounded-lg text-green-700 font-semibold">Great job! No major opportunities found.</li>';
            } else {
                 report.opportunities.forEach((op, index) => {
                    const li = document.createElement('li');
                    li.className = 'p-3 bg-red-50 border-l-4 border-red-400 rounded-lg flex justify-between items-center';
                    li.innerHTML = `
                        <span class="text-gray-700">${index + 1}. ${op.title}</span>
                        <span class="text-sm font-semibold text-red-600">${op.estimatedSavings} saved</span>
                    `;
                    opportunitiesList.appendChild(li);
                });
            }

            // 6. Render Diagnostics List
            const diagnosticsList = document.getElementById('diagnostics-list');
            diagnosticsList.innerHTML = '';
            report.diagnostics.forEach((op) => {
                const li = document.createElement('li');
                li.className = 'p-3 bg-green-50 border-l-4 border-green-400 rounded-lg flex justify-between items-center';
                li.innerHTML = `
                    <span class="text-gray-700">${op.title}</span>
                `;
                diagnosticsList.appendChild(li);
            });
        }


        // --- Chart.js Visualization ---

        function getScoreColor(score) {
            if (score >= 90) return '#10b981'; // Green (Emerald-500)
            if (score >= 50) return '#f59e0b'; // Yellow (Amber-500)
            return '#ef4444'; // Red (Red-500)
        }
        
        /**
         * Renders the Overall Lighthouse Score Gauge Chart.
         * @param {number} score - The current overall performance score (0-100).
         */
        function renderScoreGauge(score) {
            if (scoreGaugeInstance) scoreGaugeInstance.destroy();

            const scoreColor = getScoreColor(score);
            const dataPoint = score;
            
            const ctx = document.getElementById('scoreGauge').getContext('2d');
            scoreGaugeInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    datasets: [{
                        data: [dataPoint, 100 - dataPoint],
                        backgroundColor: [scoreColor, '#e5e7eb'],
                        borderWidth: 0,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '80%',
                    plugins: {
                        tooltip: { enabled: false },
                        legend: { display: false }
                    },
                    // Disable all events on the gauge for static display
                    events: [] 
                },
            });
        }

        /**
         * Renders the Multi-Metric Historical Trend Chart (Score and LCP).
         */
        function renderHistoricalChart() {
            if (historicalChartInstance) historicalChartInstance.destroy();

            const ctx = document.getElementById('historicalChart').getContext('2d');
            
            const labels = historicalData.map(d => d.label);
            const scores = historicalData.map(d => d.score);
            const lcps = historicalData.map(d => d.lcp); // New LCP data

            historicalChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                    {
                        label: 'Lighthouse Score',
                        data: scores,
                        borderColor: '#3b82f6', // Blue-500 (Primary axis)
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        yAxisID: 'yScore',
                        fill: true,
                        tension: 0.3,
                        pointRadius: 5,
                        pointBackgroundColor: '#3b82f6'
                    },
                    {
                        label: 'LCP (Largest Contentful Paint)',
                        data: lcps,
                        borderColor: '#10b981', // Green-500 (Secondary axis)
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        yAxisID: 'yLCP',
                        fill: false,
                        tension: 0.3,
                        pointRadius: 5,
                        pointBackgroundColor: '#10b981'
                    }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    interaction: {
                        mode: 'index',
                        intersect: false,
                    },
                    plugins: {
                        legend: { display: true }
                    },
                    scales: {
                        yScore: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            min: 0,
                            max: 100,
                            title: { display: true, text: 'Score (0-100)' },
                            ticks: { stepSize: 10 }
                        },
                        yLCP: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            min: 0,
                            max: 8000, // Max LCP for visualization (8 seconds)
                            title: { display: true, text: 'LCP Time (ms)' },
                            grid: { drawOnChartArea: false }, // Only draw the grid for the primary axis
                        },
                        x: {
                            grid: { display: false },
                            ticks: { maxRotation: 45, minRotation: 45 }
                        }
                    }
                }
            });
        }

        // --- Global Functions Attachment & Initialization ---
        window.runAudit = runAudit;
        window.clearHistory = clearHistory;

        window.onload = function() {
            // Load initial historical data chart if any exists
            if (historicalData.length > 0) {
                document.getElementById('initial-message').classList.add('hidden');
                document.getElementById('dashboard-results').classList.remove('hidden');
                renderHistoricalChart();
                // Render the last score on the gauge
                renderScoreGauge(historicalData[historicalData.length - 1].score);
                document.getElementById('overall-score').textContent = historicalData[historicalData.length - 1].score;

                // Set gate status to awaiting new run
                document.getElementById('gate-status-badge').textContent = 'Ready for Next Run';
                document.getElementById('gate-status-badge').className = 'px-3 py-1 text-sm font-bold rounded-full bg-gray-200 text-gray-700';
            } else {
                // Render an initial placeholder gauge
                renderScoreGauge(75);
            }
        };
    </script>
</body>
</html>
```

Here's a breakdown of the change:

* **Inline SVG as Background Image:** I've added a `background-image` property to the `body` CSS, using a `data:image/svg+xml` URI. This embeds the SVG directly into the CSS, avoiding extra file requests.
* **Faded Lighthouse SVG:** The SVG itself is a simple lighthouse icon (derived from a common icon set). I've set its `stroke` color to a light gray (`%23cbd5e1`, which is Tailwind's `gray-300`) and a very thin `stroke-width` (0.5) to give it a delicate, outline appearance.
* **Positioning and Size:**
    * `background-position: top 50px right 50px;` places it slightly from the top and right edges.
    * `background-size: 150px;` controls its dimensions.
    * `background-attachment: fixed;` ensures it stays in place even if the user scrolls.
* **Opacity:** Crucially, `opacity: 0.1;` makes the entire lighthouse image very faded, so it acts as a subtle watermark rather than a distracting element.

This subtle visual addition reinforces the "Lighthouse" theme and adds a polished touch to your dashboard.
